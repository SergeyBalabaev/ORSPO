# Task018 ‚Äî Valgrind: –ø–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ üîç

## –ß—Ç–æ —Ç–∞–∫–æ–µ Valgrind?

**`Valgrind`** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏ –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º. –û–Ω —ç–º—É–ª–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å:

 * –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ (–Ω–µ–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏)

 * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏

 * –ó–∞–ø–∏—Å—å –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏

 * –î–≤–æ–π–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

 * –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—ã–∑–æ–≤–æ–≤ malloc/free

 ## –ü–æ–ª–µ–∑–Ω—ã–µ –æ–ø—Ü–∏–∏ Valgrind

 | –û–ø—Ü–∏—è |  –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| :--- | :--- |
|`--leak-check=full`|–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏|
|`--show-leak-kinds=all`|–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–∏–ø—ã —É—Ç–µ—á–µ–∫|
|`--track-origins=yes`|–û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π|
|`--verbose`|–ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥|
|`--log-file=valgrind.log`|–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–≤–æ–¥ –≤ —Ñ–∞–π–ª|
|`--tool=memcheck`|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Memcheck (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)|


## –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã –æ—à–∏–±–æ–∫

 | –¢–∏–ø –æ—à–∏–±–∫–∏ |  –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
|`Invalid write`|–ó–∞–ø–∏—Å—å –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏|
|`Invalid read`|–ß—Ç–µ–Ω–∏–µ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏|
|`Conditional jump depends on uninitialized value`|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π|
|`definitely lost`|–£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ (–Ω–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –±–ª–æ–∫)|
|`indirectly lost`|–ü–æ—Ç–µ—Ä—è–Ω—ã —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã|
|`still reachable`|–ü–∞–º—è—Ç—å –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞, –Ω–æ —É–∫–∞–∑–∞—Ç–µ–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç|

 ---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Valgrind
 
```bash
sudo apt-get install valgrind
```
 ---

 ## –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫ —Å Valgrind

 ```bash
# –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Å –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
gcc -g leak.c -o leak

# –ó–∞–ø—É—Å–∫ Valgrind –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
valgrind --leak-check=full ./leak

# –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
valgrind --leak-check=full --show-leak-kinds=all --track-origins=yes ./leak`
 ```
---

## –ó–∞–¥–∞–Ω–∏–µ

* –°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É —Å –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

* –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É –ø–æ–¥ `Valgrind` –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏.

* –ò–∑—É—á–∏—Ç–µ –≤—ã–≤–æ–¥ `Valgrind`. –ö–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã?

* –ò—Å–ø—Ä–∞–≤—å—Ç–µ –≤—Å–µ –æ—à–∏–±–∫–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `Valgrind` –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º.